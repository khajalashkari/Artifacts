<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squares & Square Roots Learning Hub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            color: #64748b;
        }

        .progress-bar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
            color: #374151;
        }

        .progress-track {
            width: 100%;
            height: 12px;
            background: #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .activity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .activity-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            padding: 30px;
            color: white;
            text-align: center;
        }

        .card-header h3 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-top: 15px;
        }

        .card-body {
            padding: 25px;
            text-align: center;
        }

        .card-body p {
            color: #6b7280;
            margin-bottom: 20px;
        }

        .btn {
            background: #f3f4f6;
            color: #374151;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #e5e7eb;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
        }

        /* Activity-specific styles */
        .activity-page {
            display: none;
            min-height: 100vh;
        }

        .activity-page.active {
            display: block;
        }

        .activity-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }

        .back-btn {
            background: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            margin-right: 15px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .back-btn:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .activity-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .square-grid {
            display: inline-grid;
            gap: 2px;
            padding: 20px;
            background: #f3f4f6;
            border-radius: 8px;
            margin: 20px 0;
        }

        .square-cell {
            width: 25px;
            height: 25px;
            border: 2px solid #93c5fd;
            border-radius: 4px;
            background: #dbeafe;
            transition: all 0.3s ease;
        }

        .square-cell.perfect {
            background: #3b82f6;
        }

        .square-cell.animate {
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .game-area {
            text-align: center;
            padding: 40px 20px;
        }

        .problem-display {
            font-size: 4rem;
            font-weight: 700;
            color: #1e293b;
            margin: 30px 0;
        }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 600;
        }

        .feedback.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .feedback.error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .feedback.info {
            background: #dbeafe;
            color: #1d4ed8;
            border: 1px solid #93c5fd;
        }

        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fbbf24;
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .method-steps {
            list-style: none;
        }

        .method-steps li {
            padding: 15px;
            margin: 10px 0;
            background: #f8fafc;
            border-left: 4px solid #3b82f6;
            border-radius: 0 8px 8px 0;
        }

        .method-steps li.active {
            background: #dbeafe;
            border-left-color: #1d4ed8;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .problem-display {
                font-size: 2.5rem;
            }
        }

        /* Color schemes for different activities */
        .bg-blue { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .bg-green { background: linear-gradient(135deg, #10b981, #059669); }
        .bg-purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .bg-orange { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .bg-cyan { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .bg-red { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .bg-indigo { background: linear-gradient(135deg, #6366f1, #4f46e5); }
        .bg-pink { background: linear-gradient(135deg, #ec4899, #db2777); }
        .bg-teal { background: linear-gradient(135deg, #14b8a6, #0d9488); }
        .bg-yellow { background: linear-gradient(135deg, #eab308, #ca8a04); }
        .bg-rose { background: linear-gradient(135deg, #f43f5e, #e11d48); }
        .bg-violet { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
    </style>
</head>
<body>
    <!-- Dashboard -->
    <div id="dashboard" class="activity-page active">
        <div class="container">
            <div class="header">
                <h1>Squares & Square Roots Adventure</h1>
                <p>Transform abstract math into exciting discoveries!</p>
                
                <div class="progress-bar">
                    <div class="progress-info">
                        <span>Level <span id="user-level">1</span></span>
                        <span><span id="user-xp">0</span>/100 XP</span>
                    </div>
                    <div class="progress-track">
                        <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <div class="activity-grid">
                <div class="activity-card" onclick="showActivity('visual-builder')">
                    <div class="card-header bg-blue">
                        <div style="font-size: 3rem;">🟦</div>
                        <h3>Visual Square Builder</h3>
                    </div>
                    <div class="card-body">
                        <p>Build squares and discover patterns</p>
                        <button class="btn">Start ▶</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('square-detective')">
                    <div class="card-header bg-green">
                        <div style="font-size: 3rem;">🎯</div>
                        <h3>Perfect Square Detective</h3>
                    </div>
                    <div class="card-body">
                        <p>Identify perfect squares with detective skills</p>
                        <button class="btn">Start ▶</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('calculator-workshop')">
                    <div class="card-header bg-purple">
                        <div style="font-size: 3rem;">📐</div>
                        <h3>Calculator Workshop</h3>
                    </div>
                    <div class="card-body">
                        <p>Master different calculation methods</p>
                        <button class="btn">Start ▶</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('estimation-master')">
                    <div class="card-header bg-orange">
                        <div style="font-size: 3rem;">🎲</div>
                        <h3>Estimation Master</h3>
                    </div>
                    <div class="card-body">
                        <p>Challenge your estimation skills</p>
                        <button class="btn">Start ▶</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('construction-studio')">
                    <div class="card-header bg-cyan">
                        <div style="font-size: 3rem;">🏗️</div>
                        <h3>Construction Studio</h3>
                    </div>
                    <div class="card-body">
                        <p>Solve real-world design problems</p>
                        <button class="btn">Start ▶</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('speed-arena')">
                    <div class="card-header bg-red">
                        <div style="font-size: 3rem;">⚡</div>
                        <h3>Speed Arena</h3>
                    </div>
                    <div class="card-body">
                        <p>Fast-paced calculation challenges</p>
                        <button class="btn">Start ▶</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('pattern-explorer')">
                    <div class="card-header bg-indigo">
                        <div style="font-size: 3rem;">🔍</div>
                        <h3>Pattern Explorer</h3>
                    </div>
                    <div class="card-body">
                        <p>Discover mathematical patterns</p>
                        <button class="btn">Start ▶</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('battle-game')">
                    <div class="card-header bg-pink">
                        <div style="font-size: 3rem;">🎮</div>
                        <h3>Square Root Battle</h3>
                    </div>
                    <div class="card-body">
                        <p>Strategic card-based gameplay</p>
                        <button class="btn">Start ▶</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('problem-solver')">
                    <div class="card-header bg-teal">
                        <div style="font-size: 3rem;">📊</div>
                        <h3>Real-World Solver</h3>
                    </div>
                    <div class="card-body">
                        <p>Apply concepts to real scenarios</p>
                        <button class="btn">Start ▶</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('method-trainer')">
                    <div class="card-header bg-yellow">
                        <div style="font-size: 3rem;">🧩</div>
                        <h3>Method Trainer</h3>
                    </div>
                    <div class="card-body">
                        <p>Perfect your calculation techniques</p>
                        <button class="btn">Start ▶</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('error-detective')">
                    <div class="card-header bg-rose">
                        <div style="font-size: 3rem;">❌</div>
                        <h3>Error Detective</h3>
                    </div>
                    <div class="card-body">
                        <p>Find and fix mathematical mistakes</p>
                        <button class="btn">Start ▶</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('creative-studio')">
                    <div class="card-header bg-violet">
                        <div style="font-size: 3rem;">🎨</div>
                        <h3>Creative Studio</h3>
                    </div>
                    <div class="card-body">
                        <p>Explore artistic mathematical patterns</p>
                        <button class="btn">Start ▶</button>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" style="color: #3b82f6;" id="squares-found">0</div>
                    <div class="stat-label">Perfect Squares Found</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #10b981;" id="roots-calculated">0</div>
                    <div class="stat-label">Square Roots Calculated</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #f59e0b;" id="estimations-attempted">0</div>
                    <div class="stat-label">Estimations Attempted</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #8b5cf6;" id="achievements-earned">0</div>
                    <div class="stat-label">Achievements Earned</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Visual Square Builder -->
    <div id="visual-builder" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">🏠</button>
                <h2>Visual Square Builder</h2>
            </div>
            
            <div class="two-column">
                <div class="activity-content">
                    <h3>Build Your Square</h3>
                    
                    <div class="input-group">
                        <label>Square Size: <span id="square-size-display">3</span> × <span id="square-size-display-2">3</span></label>
                        <input type="range" id="square-size" min="1" max="10" value="3" oninput="updateSquare()">
                    </div>

                    <div id="square-info">
                        <p><strong>3² = 3 × 3 = 9</strong></p>
                        <p>Area: 9 square units</p>
                    </div>

                    <button class="btn btn-primary" onclick="animateSquare()">Build Square Animation</button>

                    <div class="input-group">
                        <label>
                            <input type="checkbox" id="show-pattern" onchange="togglePattern()"> Show Odd Number Pattern
                        </label>
                    </div>

                    <div id="pattern-info" style="display: none;">
                        <div class="feedback info">
                            <strong>Pattern Discovery:</strong><br>
                            <span id="odd-sum">1 + 3 + 5 = 9</span><br>
                            <small>Sum of first 3 odd numbers = 3²</small>
                        </div>
                    </div>
                </div>

                <div class="activity-content">
                    <h3>Visual Representation</h3>
                    <div style="text-align: center;">
                        <div id="square-visual" class="square-grid" style="grid-template-columns: repeat(3, 1fr);">
                            <!-- Square cells will be generated here -->
                        </div>
                        <p style="color: #6b7280; font-size: 0.875rem;">Perfect squares highlighted in dark blue</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Square Detective -->
    <div id="square-detective" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">🏠</button>
                <h2>Perfect Square Detective</h2>
            </div>

            <div class="activity-content">
                <div class="game-area">
                    <p style="color: #6b7280;">Current Investigation:</p>
                    <div class="problem-display" id="detective-number">16</div>
                    <p style="font-size: 1.1rem; margin-bottom: 30px;">Is this a perfect square?</p>

                    <div style="margin-bottom: 30px;">
                        <button class="btn btn-primary" style="margin: 0 10px; padding: 15px 30px; font-size: 1.1rem;" onclick="checkPerfectSquare(true)">
                            Yes, Perfect Square!
                        </button>
                        <button class="btn" style="margin: 0 10px; padding: 15px 30px; font-size: 1.1rem; background: #ef4444; color: white;" onclick="checkPerfectSquare(false)">
                            No, Not Perfect
                        </button>
                    </div>

                    <div id="detective-feedback"></div>

                    <div id="detective-proof" style="display: none;"></div>

                    <button class="btn" onclick="generateDetectiveNumber()">Next Number</button>

                    <div class="stats-grid" style="margin-top: 30px;">
                        <div class="stat-card">
                            <div class="stat-number" style="color: #3b82f6;" id="detective-score">0</div>
                            <div class="stat-label">Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: #10b981;" id="detective-streak">0</div>
                            <div class="stat-label">Streak</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: #8b5cf6;" id="detective-total">0</div>
                            <div class="stat-label">Total Found</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estimation Master -->
    <div id="estimation-master" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">🏠</button>
                <h2>Estimation Master Challenge</h2>
            </div>

            <div class="activity-content">
                <div class="input-group">
                    <label>Difficulty Level:</label>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" id="diff-easy" onclick="setDifficulty('easy')">Easy</button>
                        <button class="btn" id="diff-medium" onclick="setDifficulty('medium')">Medium</button>
                        <button class="btn" id="diff-hard" onclick="setDifficulty('hard')">Hard</button>
                    </div>
                </div>

                <div class="game-area">
                    <p style="color: #6b7280;">Estimate the square root of:</p>
                    <div class="problem-display">√<span id="estimation-number">50</span></div>
                    
                    <input type="number" id="estimation-input" step="0.1" placeholder="Your estimate..." 
                           style="font-size: 1.5rem; text-align: center; padding: 15px; width: 200px; margin: 20px 0;">

                    <br>
                    <button class="btn btn-primary" onclick="checkEstimation()">Check Estimate</button>

                    <div id="estimation-feedback"></div>

                    <div class="feedback info" style="margin-top: 30px;">
                        <h4>Estimation Strategy:</h4>
                        <ul style="text-align: left; margin-top: 10px;">
                            <li>Find perfect squares around your number</li>
                            <li>Use the "sandwich" method to narrow the range</li>
                            <li>Consider how close to each perfect square</li>
                            <li id="estimation-hint">For 50: 7² = 49 and 8² = 64</li>
                        </ul>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 30px;">
                        <button class="btn" onclick="newEstimationChallenge()">New Challenge</button>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;" id="estimation-score">0</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">Score</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Speed Arena -->
    <div id="speed-arena" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">🏠</button>
                <h2>Speed Challenge Arena</h2>
            </div>

            <div class="activity-content">
                <div id="speed-setup" class="game-area">
                    <h3 style="margin-bottom: 30px;">Choose Your Challenge</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 40px;">
                        <button class="btn btn-primary" id="mode-squares" onclick="setSpeedMode('squares')" style="padding: 30px;">
                            <div style="font-size: 1.2rem; font-weight: bold;">Perfect Squares</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">Calculate n²</div>
                        </button>
                        <button class="btn" id="mode-roots" onclick="setSpeedMode('roots')" style="padding: 30px;">
                            <div style="font-size: 1.2rem; font-weight: bold;">Square Roots</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">Calculate √n</div>
                        </button>
                    </div>

                    <button class="btn btn-primary" onclick="startSpeedGame()" style="padding: 20px 50px; font-size: 1.5rem;">
                        Start 60-Second Challenge!
                    </button>
                </div>

                <div id="speed-game" class="game-area" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
                        <div style="font-size: 2rem; font-weight: bold; color: #ef4444;" id="speed-timer">60s</div>
                        <div style="font-size: 1.2rem;">Score: <span id="speed-score">0</span></div>
                        <div style="font-size: 1.2rem;">Streak: <span id="speed-streak">0</span></div>
                    </div>

                    <div class="problem-display" id="speed-problem">5² = ?</div>
                    
                    <input type="number" id="speed-input" placeholder="Your answer..."
                           style="font-size: 2rem; text-align: center; padding: 15px; width: 250px; margin: 20px 0;">

                    <br>
                    <button class="btn btn-primary" onclick="checkSpeedAnswer()">Submit Answer</button>
                </div>

                <div id="speed-results" class="game-area" style="display: none;">
                    <div class="feedback success">
                        <div style="font-size: 2rem; font-weight: bold; margin-bottom: 10px;">Final Score: <span id="final-score">0</span></div>
                        <div style="font-size: 1.1rem;">Great job! You're getting faster at mental math!</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- More activities would be added here... -->

    <script>
        // Global state
        let userProgress = {
            level: 1,
            xp: 0,
            achievements: [],
            stats: {
                perfectSquaresFound: 0,
                squareRootsCalculated: 0,
                estimationsAttempted: 0,
                problemsSolved: 0
            }
        };

        // Game state
        let currentDetectiveNumber = 16;
        let detectiveScore = 0;
        let detectiveStreak = 0;
        let estimationDifficulty = 'easy';
        let estimationScore = 0;
        let speedMode = 'squares';
        let speedGameActive = false;
        let speedTimer = 60;
        let speedScore = 0;
        let speedStreak = 0;
        let currentSpeedProblem = { question: '', answer: 0 };

        // Utility functions
        function addXP(amount) {
            userProgress.xp += amount;
            userProgress.level = Math.floor(userProgress.xp / 100) + 1;
            updateProgressDisplay();
        }

        function addAchievement(achievement) {
            if (!userProgress.achievements.includes(achievement)) {
                userProgress.achievements.push(achievement);
                showAchievement(achievement);
                updateStatsDisplay();
            }
        }

        function showAchievement(achievement) {
            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div style="display: flex; align-items: center;">
                    <div style="font-size: 2rem; margin-right: 15px;">🏆</div>
                    <div>
                        <div style="font-weight: bold;">Achievement Unlocked!</div>
                        <div style="font-size: 0.9rem;">${achievement}</div>
                    </div>
                </div>
            `;
            document.body.appendChild(popup);
            setTimeout(() => document.body.removeChild(popup), 3000);
        }

        function updateProgressDisplay() {
            document.getElementById('user-level').textContent = userProgress.level;
            document.getElementById('user-xp').textContent = userProgress.xp % 100;
            document.getElementById('progress-fill').style.width = `${(userProgress.xp % 100)}%`;
        }

        function updateStatsDisplay() {
            document.getElementById('squares-found').textContent = userProgress.stats.perfectSquaresFound;
            document.getElementById('roots-calculated').textContent = userProgress.stats.squareRootsCalculated;
            document.getElementById('estimations-attempted').textContent = userProgress.stats.estimationsAttempted;
            document.getElementById('achievements-earned').textContent = userProgress.achievements.length;
        }

        // Navigation functions
        function showActivity(activityId) {
            document.querySelectorAll('.activity-page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(activityId).classList.add('active');

            // Initialize activity-specific content
            if (activityId === 'visual-builder') {
                updateSquare();
            } else if (activityId === 'square-detective') {
                generateDetectiveNumber();
            } else if (activityId === 'estimation-master') {
                newEstimationChallenge();
            }
        }

        function showDashboard() {
            document.querySelectorAll('.activity-page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById('dashboard').classList.add('active');
        }

        // Visual Square Builder functions
        function updateSquare() {
            const size = parseInt(document.getElementById('square-size').value);
            document.getElementById('square-size-display').textContent = size;
            document.getElementById('square-size-display-2').textContent = size;
            
            const area = size * size;
            document.getElementById('square-info').innerHTML = `
                <p><strong>${size}² = ${size} × ${size} = ${area}</strong></p>
                <p>Area: ${area} square units</p>
            `;

            // Update visual
            const visual = document.getElementById('square-visual');
            visual.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            visual.innerHTML = '';

            for (let i = 1; i <= area; i++) {
                const cell = document.createElement('div');
                cell.className = 'square-cell';
                const root = Math.sqrt(i);
                if (root === Math.floor(root)) {
                    cell.classList.add('perfect');
                }
                visual.appendChild(cell);
            }

            // Update pattern
            if (document.getElementById('show-pattern').checked) {
                updateOddPattern(size);
            }
        }

        function updateOddPattern(size) {
            const oddNumbers = [];
            for (let i = 1; i <= size; i++) {
                oddNumbers.push(2 * i - 1);
            }
            const sum = oddNumbers.reduce((a, b) => a + b, 0);
            document.getElementById('odd-sum').textContent = `${oddNumbers.join(' + ')} = ${sum}`;
        }

        function animateSquare() {
            const cells = document.querySelectorAll('#square-visual .square-cell');
            cells.forEach((cell, index) => {
                setTimeout(() => {
                    cell.classList.add('animate');
                    setTimeout(() => cell.classList.remove('animate'), 500);
                }, index * 50);
            });
            addXP(10);
        }

        function togglePattern() {
            const patternInfo = document.getElementById('pattern-info');
            const checkbox = document.getElementById('show-pattern');
            
            if (checkbox.checked) {
                patternInfo.style.display = 'block';
                updateOddPattern(parseInt(document.getElementById('square-size').value));
            } else {
                patternInfo.style.display = 'none';
            }
        }

        // Square Detective functions
        function generateDetectiveNumber() {
            const numbers = [4, 9, 15, 16, 20, 25, 30, 36, 49, 50, 64, 75, 81, 100, 121, 144, 169, 196, 225];
            currentDetectiveNumber = numbers[Math.floor(Math.random() * numbers.length)];
            document.getElementById('detective-number').textContent = currentDetectiveNumber;
            document.getElementById('detective-feedback').innerHTML = '';
            document.getElementById('detective-proof').style.display = 'none';
        }

        function checkPerfectSquare(userAnswer) {
            const actualRoot = Math.sqrt(currentDetectiveNumber);
            const isActuallyPerfect = actualRoot === Math.floor(actualRoot);
            
            const feedbackEl = document.getElementById('detective-feedback');
            const proofEl = document.getElementById('detective-proof');
            
            if (userAnswer === isActuallyPerfect) {
                detectiveScore += 10;
                detectiveStreak++;
                feedbackEl.innerHTML = '<div class="feedback success">Correct! 🎉</div>';
                addXP(15);
                userProgress.stats.perfectSquaresFound++;
                
                // Check achievements
                if (detectiveStreak === 5) {
                    addAchievement('Detective Streak - 5 in a row!');
                }
                if (userProgress.stats.perfectSquaresFound === 25) {
                    addAchievement('Square Master - Found 25 perfect squares!');
                }
            } else {
                detectiveStreak = 0;
                feedbackEl.innerHTML = '<div class="feedback error">Not quite right. Try again!</div>';
            }
            
            // Show proof
            proofEl.innerHTML = `
                <div class="feedback info">
                    <strong>Proof:</strong><br>
                    √${currentDetectiveNumber} = ${actualRoot.toFixed(3)}<br>
                    ${isActuallyPerfect ? 
                        `<span style="color: #10b981;">${actualRoot} × ${actualRoot} = ${currentDetectiveNumber} ✓</span>` :
                        `<span style="color: #ef4444;">Not a whole number, so ${currentDetectiveNumber} is not a perfect square.</span>`
                    }
                </div>
            `;
            proofEl.style.display = 'block';
            
            // Update display
            document.getElementById('detective-score').textContent = detectiveScore;
            document.getElementById('detective-streak').textContent = detectiveStreak;
            document.getElementById('detective-total').textContent = userProgress.stats.perfectSquaresFound;
            updateStatsDisplay();
        }

        // Estimation Master functions
        function setDifficulty(level) {
            estimationDifficulty = level;
            document.querySelectorAll('[id^="diff-"]').forEach(btn => {
                btn.className = 'btn';
            });
            document.getElementById(`diff-${level}`).className = 'btn btn-primary';
            newEstimationChallenge();
        }

        function newEstimationChallenge() {
            const ranges = {
                easy: [1, 100],
                medium: [100, 500],
                hard: [500, 1000]
            };
            
            const range = ranges[estimationDifficulty];
            const number = Math.floor(Math.random() * (range[1] - range[0])) + range[0];
            
            document.getElementById('estimation-number').textContent = number;
            document.getElementById('estimation-input').value = '';
            document.getElementById('estimation-feedback').innerHTML = '';
            
            // Update hint
            const lower = Math.floor(Math.sqrt(number));
            const upper = lower + 1;
            document.getElementById('estimation-hint').textContent = 
                `For ${number}: ${lower}² = ${lower * lower} and ${upper}² = ${upper * upper}`;
        }

        function checkEstimation() {
            const number = parseInt(document.getElementById('estimation-number').textContent);
            const userEstimate = parseFloat(document.getElementById('estimation-input').value);
            const actual = Math.sqrt(number);
            const difference = Math.abs(actual - userEstimate);
            
            const tolerances = { easy: 0.5, medium: 0.3, hard: 0.2 };
            const tolerance = tolerances[estimationDifficulty];
            
            const feedbackEl = document.getElementById('estimation-feedback');
            
            if (difference <= tolerance) {
                estimationScore += 10;
                feedbackEl.innerHTML = `<div class="feedback success">Excellent! √${number} ≈ ${actual.toFixed(3)}</div>`;
                addXP(15);
                userProgress.stats.estimationsAttempted++;
                
                // Check achievements
                if (estimationDifficulty === 'hard') {
                    addAchievement('Estimation Expert - Mastered hard mode!');
                }
                if (estimationScore >= 100) {
                    addAchievement('Century Scorer - 100+ estimation points!');
                }
            } else {
                feedbackEl.innerHTML = `<div class="feedback error">Close! √${number} ≈ ${actual.toFixed(3)}. You estimated ${userEstimate}</div>`;
                userProgress.stats.estimationsAttempted++;
            }
            
            document.getElementById('estimation-score').textContent = estimationScore;
            updateStatsDisplay();
        }

        // Speed Arena functions
        function setSpeedMode(mode) {
            speedMode = mode;
            document.getElementById('mode-squares').className = mode === 'squares' ? 'btn btn-primary' : 'btn';
            document.getElementById('mode-roots').className = mode === 'roots' ? 'btn btn-primary' : 'btn';
        }

        function startSpeedGame() {
            speedGameActive = true;
            speedTimer = 60;
            speedScore = 0;
            speedStreak = 0;
            
            document.getElementById('speed-setup').style.display = 'none';
            document.getElementById('speed-game').style.display = 'block';
            document.getElementById('speed-results').style.display = 'none';
            
            generateSpeedProblem();
            startSpeedTimer();
        }

        function generateSpeedProblem() {
            if (speedMode === 'squares') {
                const num = Math.floor(Math.random() * 15) + 1;
                currentSpeedProblem = { question: `${num}²`, answer: num * num };
            } else {
                const perfectSquares = [1, 4, 9, 16, 25, 36, 49, 64, 81, 100, 121, 144, 169, 196, 225];
                const square = perfectSquares[Math.floor(Math.random() * perfectSquares.length)];
                currentSpeedProblem = { question: `√${square}`, answer: Math.sqrt(square) };
            }
            
            document.getElementById('speed-problem').textContent = `${currentSpeedProblem.question} = ?`;
            document.getElementById('speed-input').value = '';
            document.getElementById('speed-input').focus();
        }

        function checkSpeedAnswer() {
            const userAnswer = parseInt(document.getElementById('speed-input').value);
            
            if (userAnswer === currentSpeedProblem.answer) {
                speedScore += (10 + speedStreak);
                speedStreak++;
                addXP(5);
                
                // Check achievements
                if (speedStreak === 10) {
                    addAchievement('Speed Demon - 10 streak!');
                }
                if (speedScore >= 200) {
                    addAchievement('Lightning Calculator - 200+ speed points!');
                }
            } else {
                speedStreak = 0;
            }
            
            document.getElementById('speed-score').textContent = speedScore;
            document.getElementById('speed-streak').textContent = speedStreak;
            
            generateSpeedProblem();
        }

        function startSpeedTimer() {
            const timerInterval = setInterval(() => {
                speedTimer--;
                document.getElementById('speed-timer').textContent = `${speedTimer}s`;
                
                if (speedTimer <= 0) {
                    clearInterval(timerInterval);
                    endSpeedGame();
                }
            }, 1000);
        }

        function endSpeedGame() {
            speedGameActive = false;
            document.getElementById('speed-game').style.display = 'none';
            document.getElementById('speed-results').style.display = 'block';
            document.getElementById('final-score').textContent = speedScore;
            
            setTimeout(() => {
                document.getElementById('speed-setup').style.display = 'block';
                document.getElementById('speed-results').style.display = 'none';
            }, 5000);
        }

        // Event listeners
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeElement = document.activeElement;
                if (activeElement.id === 'speed-input' && speedGameActive) {
                    checkSpeedAnswer();
                } else if (activeElement.id === 'estimation-input') {
                    checkEstimation();
                }
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateProgressDisplay();
            updateStatsDisplay();
        });
    </script>
</body>
</html>
