<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squares & Square Roots Learning Hub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            color: #64748b;
        }

        .progress-bar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
            color: #374151;
        }

        .progress-track {
            width: 100%;
            height: 12px;
            background: #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .activity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .activity-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            padding: 30px;
            color: white;
            text-align: center;
        }

        .card-header h3 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-top: 15px;
        }

        .card-body {
            padding: 25px;
            text-align: center;
        }

        .card-body p {
            color: #6b7280;
            margin-bottom: 20px;
        }

        .btn {
            background: #f3f4f6;
            color: #374151;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #e5e7eb;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
        }

        /* Activity-specific styles */
        .activity-page {
            display: none;
            min-height: 100vh;
        }

        .activity-page.active {
            display: block;
        }

        .activity-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }

        .back-btn {
            background: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            margin-right: 15px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .back-btn:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .activity-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .square-grid {
            display: inline-grid;
            gap: 2px;
            padding: 20px;
            background: #f3f4f6;
            border-radius: 8px;
            margin: 20px 0;
        }

        .square-cell {
            width: 25px;
            height: 25px;
            border: 2px solid #93c5fd;
            border-radius: 4px;
            background: #dbeafe;
            transition: all 0.3s ease;
        }

        .square-cell.perfect {
            background: #3b82f6;
        }

        .square-cell.animate {
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .game-area {
            text-align: center;
            padding: 40px 20px;
        }

        .problem-display {
            font-size: 4rem;
            font-weight: 700;
            color: #1e293b;
            margin: 30px 0;
        }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 600;
        }

        .feedback.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .feedback.error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .feedback.info {
            background: #dbeafe;
            color: #1d4ed8;
            border: 1px solid #93c5fd;
        }

        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fbbf24;
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .method-steps {
            list-style: none;
        }

        .method-steps li {
            padding: 15px;
            margin: 10px 0;
            background: #f8fafc;
            border-left: 4px solid #3b82f6;
            border-radius: 0 8px 8px 0;
        }

        .method-steps li.active {
            background: #dbeafe;
            border-left-color: #1d4ed8;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .problem-display {
                font-size: 2.5rem;
            }
        }

        /* Color schemes for different activities */
        .bg-blue { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .bg-green { background: linear-gradient(135deg, #10b981, #059669); }
        .bg-purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .bg-orange { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .bg-cyan { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .bg-red { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .bg-indigo { background: linear-gradient(135deg, #6366f1, #4f46e5); }
        .bg-pink { background: linear-gradient(135deg, #ec4899, #db2777); }
        .bg-teal { background: linear-gradient(135deg, #14b8a6, #0d9488); }
        .bg-yellow { background: linear-gradient(135deg, #eab308, #ca8a04); }
        .bg-rose { background: linear-gradient(135deg, #f43f5e, #e11d48); }
        .bg-violet { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
    </style>
</head>
<body>
    <!-- Dashboard -->
    <div id="dashboard" class="activity-page active">
        <div class="container">
            <div class="header">
                <h1>Squares & Square Roots Adventure</h1>
                <p>Transform abstract math into exciting discoveries!</p>
                
                <div class="progress-bar">
                    <div class="progress-info">
                        <span>Level <span id="user-level">1</span></span>
                        <span><span id="user-xp">0</span>/100 XP</span>
                    </div>
                    <div class="progress-track">
                        <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <div class="activity-grid">
                <div class="activity-card" onclick="showActivity('visual-builder')">
                    <div class="card-header bg-blue">
                        <div style="font-size: 3rem;">üü¶</div>
                        <h3>Visual Square Builder</h3>
                    </div>
                    <div class="card-body">
                        <p>Build squares and discover patterns</p>
                        <button class="btn">Start ‚ñ∂</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('square-detective')">
                    <div class="card-header bg-green">
                        <div style="font-size: 3rem;">üéØ</div>
                        <h3>Perfect Square Detective</h3>
                    </div>
                    <div class="card-body">
                        <p>Identify perfect squares with detective skills</p>
                        <button class="btn">Start ‚ñ∂</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('calculator-workshop')">
                    <div class="card-header bg-purple">
                        <div style="font-size: 3rem;">üìê</div>
                        <h3>Calculator Workshop</h3>
                    </div>
                    <div class="card-body">
                        <p>Master different calculation methods</p>
                        <button class="btn">Start ‚ñ∂</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('estimation-master')">
                    <div class="card-header bg-orange">
                        <div style="font-size: 3rem;">üé≤</div>
                        <h3>Estimation Master</h3>
                    </div>
                    <div class="card-body">
                        <p>Challenge your estimation skills</p>
                        <button class="btn">Start ‚ñ∂</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('construction-studio')">
                    <div class="card-header bg-cyan">
                        <div style="font-size: 3rem;">üèóÔ∏è</div>
                        <h3>Construction Studio</h3>
                    </div>
                    <div class="card-body">
                        <p>Solve real-world design problems</p>
                        <button class="btn">Start ‚ñ∂</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('speed-arena')">
                    <div class="card-header bg-red">
                        <div style="font-size: 3rem;">‚ö°</div>
                        <h3>Speed Arena</h3>
                    </div>
                    <div class="card-body">
                        <p>Fast-paced calculation challenges</p>
                        <button class="btn">Start ‚ñ∂</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('pattern-explorer')">
                    <div class="card-header bg-indigo">
                        <div style="font-size: 3rem;">üîç</div>
                        <h3>Pattern Explorer</h3>
                    </div>
                    <div class="card-body">
                        <p>Discover mathematical patterns</p>
                        <button class="btn">Start ‚ñ∂</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('battle-game')">
                    <div class="card-header bg-pink">
                        <div style="font-size: 3rem;">üéÆ</div>
                        <h3>Square Root Battle</h3>
                    </div>
                    <div class="card-body">
                        <p>Strategic card-based gameplay</p>
                        <button class="btn">Start ‚ñ∂</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('problem-solver')">
                    <div class="card-header bg-teal">
                        <div style="font-size: 3rem;">üìä</div>
                        <h3>Real-World Solver</h3>
                    </div>
                    <div class="card-body">
                        <p>Apply concepts to real scenarios</p>
                        <button class="btn">Start ‚ñ∂</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('method-trainer')">
                    <div class="card-header bg-yellow">
                        <div style="font-size: 3rem;">üß©</div>
                        <h3>Method Trainer</h3>
                    </div>
                    <div class="card-body">
                        <p>Perfect your calculation techniques</p>
                        <button class="btn">Start ‚ñ∂</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('error-detective')">
                    <div class="card-header bg-rose">
                        <div style="font-size: 3rem;">‚ùå</div>
                        <h3>Error Detective</h3>
                    </div>
                    <div class="card-body">
                        <p>Find and fix mathematical mistakes</p>
                        <button class="btn">Start ‚ñ∂</button>
                    </div>
                </div>

                <div class="activity-card" onclick="showActivity('creative-studio')">
                    <div class="card-header bg-violet">
                        <div style="font-size: 3rem;">üé®</div>
                        <h3>Creative Studio</h3>
                    </div>
                    <div class="card-body">
                        <p>Explore artistic mathematical patterns</p>
                        <button class="btn">Start ‚ñ∂</button>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" style="color: #3b82f6;" id="squares-found">0</div>
                    <div class="stat-label">Perfect Squares Found</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #10b981;" id="roots-calculated">0</div>
                    <div class="stat-label">Square Roots Calculated</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #f59e0b;" id="estimations-attempted">0</div>
                    <div class="stat-label">Estimations Attempted</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #8b5cf6;" id="achievements-earned">0</div>
                    <div class="stat-label">Achievements Earned</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Visual Square Builder -->
    <div id="visual-builder" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">üè†</button>
                <h2>Visual Square Builder</h2>
            </div>
            
            <div class="two-column">
                <div class="activity-content">
                    <h3>Build Your Square</h3>
                    
                    <div class="input-group">
                        <label>Square Size: <span id="square-size-display">3</span> √ó <span id="square-size-display-2">3</span></label>
                        <input type="range" id="square-size" min="1" max="10" value="3" oninput="updateSquare()">
                    </div>

                    <div id="square-info">
                        <p><strong>3¬≤ = 3 √ó 3 = 9</strong></p>
                        <p>Area: 9 square units</p>
                    </div>

                    <button class="btn btn-primary" onclick="animateSquare()">Build Square Animation</button>

                    <div class="input-group">
                        <label>
                            <input type="checkbox" id="show-pattern" onchange="togglePattern()"> Show Odd Number Pattern
                        </label>
                    </div>

                    <div id="pattern-info" style="display: none;">
                        <div class="feedback info">
                            <strong>Pattern Discovery:</strong><br>
                            <span id="odd-sum">1 + 3 + 5 = 9</span><br>
                            <small>Sum of first 3 odd numbers = 3¬≤</small>
                        </div>
                    </div>
                </div>

                <div class="activity-content">
                    <h3>Visual Representation</h3>
                    <div style="text-align: center;">
                        <div id="square-visual" class="square-grid" style="grid-template-columns: repeat(3, 1fr);">
                            <!-- Square cells will be generated here -->
                        </div>
                        <p style="color: #6b7280; font-size: 0.875rem;">Perfect squares highlighted in dark blue</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Square Detective -->
    <div id="square-detective" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">üè†</button>
                <h2>Perfect Square Detective</h2>
            </div>

            <div class="activity-content">
                <div class="game-area">
                    <p style="color: #6b7280;">Current Investigation:</p>
                    <div class="problem-display" id="detective-number">16</div>
                    <p style="font-size: 1.1rem; margin-bottom: 30px;">Is this a perfect square?</p>

                    <div style="margin-bottom: 30px;">
                        <button class="btn btn-primary" style="margin: 0 10px; padding: 15px 30px; font-size: 1.1rem;" onclick="checkPerfectSquare(true)">
                            Yes, Perfect Square!
                        </button>
                        <button class="btn" style="margin: 0 10px; padding: 15px 30px; font-size: 1.1rem; background: #ef4444; color: white;" onclick="checkPerfectSquare(false)">
                            No, Not Perfect
                        </button>
                    </div>

                    <div id="detective-feedback"></div>

                    <div id="detective-proof" style="display: none;"></div>

                    <button class="btn" onclick="generateDetectiveNumber()">Next Number</button>

                    <div class="stats-grid" style="margin-top: 30px;">
                        <div class="stat-card">
                            <div class="stat-number" style="color: #3b82f6;" id="detective-score">0</div>
                            <div class="stat-label">Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: #10b981;" id="detective-streak">0</div>
                            <div class="stat-label">Streak</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" style="color: #8b5cf6;" id="detective-total">0</div>
                            <div class="stat-label">Total Found</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estimation Master -->
    <div id="estimation-master" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">üè†</button>
                <h2>Estimation Master Challenge</h2>
            </div>

            <div class="activity-content">
                <div class="input-group">
                    <label>Difficulty Level:</label>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" id="diff-easy" onclick="setDifficulty('easy')">Easy</button>
                        <button class="btn" id="diff-medium" onclick="setDifficulty('medium')">Medium</button>
                        <button class="btn" id="diff-hard" onclick="setDifficulty('hard')">Hard</button>
                    </div>
                </div>

                <div class="game-area">
                    <p style="color: #6b7280;">Estimate the square root of:</p>
                    <div class="problem-display">‚àö<span id="estimation-number">50</span></div>
                    
                    <input type="number" id="estimation-input" step="0.1" placeholder="Your estimate..." 
                           style="font-size: 1.5rem; text-align: center; padding: 15px; width: 200px; margin: 20px 0;">

                    <br>
                    <button class="btn btn-primary" onclick="checkEstimation()">Check Estimate</button>

                    <div id="estimation-feedback"></div>

                    <div class="feedback info" style="margin-top: 30px;">
                        <h4>Estimation Strategy:</h4>
                        <ul style="text-align: left; margin-top: 10px;">
                            <li>Find perfect squares around your number</li>
                            <li>Use the "sandwich" method to narrow the range</li>
                            <li>Consider how close to each perfect square</li>
                            <li id="estimation-hint">For 50: 7¬≤ = 49 and 8¬≤ = 64</li>
                        </ul>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 30px;">
                        <button class="btn" onclick="newEstimationChallenge()">New Challenge</button>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;" id="estimation-score">0</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">Score</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Speed Arena -->
    <div id="speed-arena" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">üè†</button>
                <h2>Speed Challenge Arena</h2>
            </div>

            <div class="activity-content">
                <div id="speed-setup" class="game-area">
                    <h3 style="margin-bottom: 30px;">Choose Your Challenge</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 40px;">
                        <button class="btn btn-primary" id="mode-squares" onclick="setSpeedMode('squares')" style="padding: 30px;">
                            <div style="font-size: 1.2rem; font-weight: bold;">Perfect Squares</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">Calculate n¬≤</div>
                        </button>
                        <button class="btn" id="mode-roots" onclick="setSpeedMode('roots')" style="padding: 30px;">
                            <div style="font-size: 1.2rem; font-weight: bold;">Square Roots</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">Calculate ‚àön</div>
                        </button>
                    </div>

                    <button class="btn btn-primary" onclick="startSpeedGame()" style="padding: 20px 50px; font-size: 1.5rem;">
                        Start 60-Second Challenge!
                    </button>
                </div>

                <div id="speed-game" class="game-area" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
                        <div style="font-size: 2rem; font-weight: bold; color: #ef4444;" id="speed-timer">60s</div>
                        <div style="font-size: 1.2rem;">Score: <span id="speed-score">0</span></div>
                        <div style="font-size: 1.2rem;">Streak: <span id="speed-streak">0</span></div>
                    </div>

                    <div class="problem-display" id="speed-problem">5¬≤ = ?</div>
                    
                    <input type="number" id="speed-input" placeholder="Your answer..."
                           style="font-size: 2rem; text-align: center; padding: 15px; width: 250px; margin: 20px 0;">

                    <br>
                    <button class="btn btn-primary" onclick="checkSpeedAnswer()">Submit Answer</button>
                </div>

                <div id="speed-results" class="game-area" style="display: none;">
                    <div class="feedback success">
                        <div style="font-size: 2rem; font-weight: bold; margin-bottom: 10px;">Final Score: <span id="final-score">0</span></div>
                        <div style="font-size: 1.1rem;">Great job! You're getting faster at mental math!</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- More activities would be added here... -->

    <!-- Calculator Workshop -->
    <div id="calculator-workshop" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">üè†</button>
                <h2>Calculator Workshop</h2>
            </div>
            
            <div class="two-column">
                <div class="activity-content">
                    <h3>Choose Method</h3>
                    
                    <button class="btn btn-primary" id="method-prime" onclick="setMethod('prime')" style="width: 100%; margin-bottom: 10px;">
                        Prime Factorization
                    </button>
                    <button class="btn" id="method-long" onclick="setMethod('long')" style="width: 100%; margin-bottom: 10px;">
                        Long Division Method
                    </button>
                    <button class="btn" id="method-estimation" onclick="setMethod('estimation')" style="width: 100%; margin-bottom: 20px;">
                        Estimation Method
                    </button>

                    <div class="input-group">
                        <label>Target Number:</label>
                        <input type="number" id="target-number" value="144" onchange="updateMethodDemo()">
                    </div>
                </div>

                <div class="activity-content">
                    <h3 id="method-title">Prime Factorization for ‚àö144</h3>
                    
                    <ol class="method-steps" id="method-steps">
                        <li>Find prime factors of 144</li>
                        <li>144 = 2‚Å¥ √ó 3¬≤</li>
                        <li>Group into pairs: (2¬≤)¬≤ √ó (3¬π)¬≤</li>
                        <li>Take one from each pair: 2¬≤ √ó 3 = 12</li>
                        <li>‚àö144 = 12</li>
                    </ol>

                    <button class="btn btn-primary" onclick="addXP(20)">Practice This Method</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Construction Studio -->
    <div id="construction-studio" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">üè†</button>
                <h2>Construction & Design Studio</h2>
            </div>
            
            <div class="two-column">
                <div class="activity-content">
                    <h3>Project Selection</h3>
                    
                    <button class="btn btn-primary" id="project-garden" onclick="setProject('garden')" style="width: 100%; margin-bottom: 10px;">
                        Square Garden Plot
                    </button>
                    <button class="btn" id="project-room" onclick="setProject('room')" style="width: 100%; margin-bottom: 10px;">
                        Square Room Tiles
                    </button>
                    <button class="btn" id="project-frame" onclick="setProject('frame')" style="width: 100%; margin-bottom: 20px;">
                        Photo Frame Design
                    </button>

                    <div class="input-group">
                        <label>Total Area (sq meters):</label>
                        <input type="number" id="construction-area" value="100" onchange="calculateDimensions()">
                    </div>

                    <button class="btn btn-primary" onclick="calculateDimensions()">Calculate Dimensions</button>
                </div>

                <div class="activity-content">
                    <h3>Design Results</h3>
                    
                    <div id="construction-results">
                        <div class="feedback info">
                            <strong>Square Dimensions:</strong><br>
                            <span id="side-length">10.00 √ó 10.00</span><br>
                            <small>Side length: <span id="side-value">10.00</span> units</small>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <div style="width: 150px; height: 150px; border: 4px solid #06b6d4; background: #cffafe; margin: 0 auto; position: relative; display: flex; align-items: center; justify-content: center;">
                                <div style="text-align: center;">
                                    <div style="font-weight: bold;" id="area-display">100</div>
                                    <div style="font-size: 0.8rem;">sq units</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pattern Explorer -->
    <div id="pattern-explorer" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">üè†</button>
                <h2>Pattern Explorer Lab</h2>
            </div>
            
            <div class="activity-content">
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" id="pattern-algebraic" onclick="setPattern('algebraic')" style="margin-right: 10px;">
                        (a+b)¬≤ Pattern
                    </button>
                    <button class="btn" id="pattern-endings" onclick="setPattern('endings')" style="margin-right: 10px;">
                        Square Endings
                    </button>
                    <button class="btn" id="pattern-geometric" onclick="setPattern('geometric')">
                        Geometric Patterns
                    </button>
                </div>

                <div id="algebraic-pattern">
                    <h3>Explore: (a+b)¬≤ = a¬≤ + 2ab + b¬≤</h3>
                    
                    <div class="two-column">
                        <div>
                            <div class="input-group">
                                <label>Value of a:</label>
                                <input type="number" id="pattern-a" value="3" onchange="updateAlgebraicPattern()">
                            </div>
                            
                            <div class="input-group">
                                <label>Value of b:</label>
                                <input type="number" id="pattern-b" value="2" onchange="updateAlgebraicPattern()">
                            </div>

                            <div class="feedback success" id="pattern-calculation">
                                <div>Left side: (3+2)¬≤ = <strong>25</strong></div>
                                <div>Right side: 3¬≤ + 2(3)(2) + 2¬≤ = 9 + 12 + 4 = <strong>25</strong></div>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; margin-bottom: 10px;">Visual Representation</div>
                            <div id="algebraic-visual" style="display: inline-grid; gap: 1px; grid-template-columns: repeat(5, 20px);">
                                <!-- Grid will be generated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <div id="endings-pattern" style="display: none;">
                    <h3>Square Number Endings Pattern</h3>
                    
                    <div class="feedback info">
                        <strong>Discovery:</strong> Perfect squares can only end in: 0, 1, 4, 5, 6, 9
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-top: 20px;">
                        <div style="text-align: center; padding: 15px; border: 2px solid #6366f1; border-radius: 8px;">
                            <div style="font-weight: bold;">1¬≤</div>
                            <div style="font-size: 1.5rem; color: #6366f1;">1</div>
                            <div style="font-size: 0.8rem;">Ends in 1</div>
                        </div>
                        <div style="text-align: center; padding: 15px; border: 2px solid #6366f1; border-radius: 8px;">
                            <div style="font-weight: bold;">2¬≤</div>
                            <div style="font-size: 1.5rem; color: #6366f1;">4</div>
                            <div style="font-size: 0.8rem;">Ends in 4</div>
                        </div>
                        <div style="text-align: center; padding: 15px; border: 2px solid #6366f1; border-radius: 8px;">
                            <div style="font-weight: bold;">3¬≤</div>
                            <div style="font-size: 1.5rem; color: #6366f1;">9</div>
                            <div style="font-size: 0.8rem;">Ends in 9</div>
                        </div>
                        <div style="text-align: center; padding: 15px; border: 2px solid #6366f1; border-radius: 8px;">
                            <div style="font-weight: bold;">4¬≤</div>
                            <div style="font-size: 1.5rem; color: #6366f1;">16</div>
                            <div style="font-size: 0.8rem;">Ends in 6</div>
                        </div>
                        <div style="text-align: center; padding: 15px; border: 2px solid #6366f1; border-radius: 8px;">
                            <div style="font-weight: bold;">5¬≤</div>
                            <div style="font-size: 1.5rem; color: #6366f1;">25</div>
                            <div style="font-size: 0.8rem;">Ends in 5</div>
                        </div>
                    </div>
                </div>

                <div id="geometric-pattern" style="display: none;">
                    <h3>Geometric Square Patterns</h3>
                    
                    <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px;">
                        <div style="text-align: center;">
                            <div style="font-weight: bold; margin-bottom: 10px;">1¬≤ = 1</div>
                            <div style="width: 20px; height: 20px; background: #8b5cf6; margin: 0 auto;"></div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-weight: bold; margin-bottom: 10px;">2¬≤ = 4</div>
                            <div style="display: grid; grid-template-columns: repeat(2, 20px); gap: 1px; margin: 0 auto; width: fit-content;">
                                <div style="width: 20px; height: 20px; background: #8b5cf6;"></div>
                                <div style="width: 20px; height: 20px; background: #8b5cf6;"></div>
                                <div style="width: 20px; height: 20px; background: #8b5cf6;"></div>
                                <div style="width: 20px; height: 20px; background: #8b5cf6;"></div>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-weight: bold; margin-bottom: 10px;">3¬≤ = 9</div>
                            <div style="display: grid; grid-template-columns: repeat(3, 20px); gap: 1px; margin: 0 auto; width: fit-content;">
                                <div style="width: 20px; height: 20px; background: #8b5cf6;"></div>
                                <div style="width: 20px; height: 20px; background: #8b5cf6;"></div>
                                <div style="width: 20px; height: 20px; background: #8b5cf6;"></div>
                                <div style="width: 20px; height: 20px; background: #8b5cf6;"></div>
                                <div style="width: 20px; height: 20px; background: #8b5cf6;"></div>
                                <div style="width: 20px; height: 20px; background: #8b5cf6;"></div>
                                <div style="width: 20px; height: 20px; background: #8b5cf6;"></div>
                                <div style="width: 20px; height: 20px; background: #8b5cf6;"></div>
                                <div style="width: 20px; height: 20px; background: #8b5cf6;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Battle Game -->
    <div id="battle-game" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">üè†</button>
                <h2>Square Root Battle</h2>
            </div>
            
            <div class="activity-content">
                <div class="game-area">
                    <h3 style="margin-bottom: 30px;">Ready for Battle?</h3>
                    <p style="color: #6b7280; margin-bottom: 40px;">
                        Choose cards with higher square roots to win! Each round, the higher value wins the point.
                    </p>
                    <button class="btn btn-primary" onclick="startBattleGame()" style="padding: 20px 50px; font-size: 1.5rem;">
                        Start Battle!
                    </button>

                    <div id="battle-arena" style="display: none; margin-top: 40px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                            <div style="text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #3b82f6;">0</div>
                                <div>Your Score</div>
                            </div>
                            <div style="font-size: 1.2rem; font-weight: bold;">VS</div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #ef4444;">0</div>
                                <div>Computer Score</div>
                            </div>
                        </div>

                        <div class="feedback success">
                            <div style="font-size: 1.5rem; margin-bottom: 20px;">Battle simulation activated!</div>
                            <div>Click cards to play against the computer. Higher square root values win!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Problem Solver -->
    <div id="problem-solver" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">üè†</button>
                <h2>Real-World Problem Solver</h2>
            </div>
            
            <div class="activity-content">
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" id="category-physics" onclick="setCategory('physics')" style="margin-right: 10px;">
                        Physics
                    </button>
                    <button class="btn" id="category-architecture" onclick="setCategory('architecture')" style="margin-right: 10px;">
                        Architecture
                    </button>
                    <button class="btn" id="category-technology" onclick="setCategory('technology')">
                        Technology
                    </button>
                </div>

                <div id="current-problem">
                    <h3>Free Fall Motion</h3>
                    
                    <div class="feedback info" style="margin-bottom: 20px;">
                        <strong>Problem:</strong> A ball is dropped from a 144-meter tall building. How long does it take to hit the ground? (Use g = 9.8 m/s¬≤, h = ¬Ωgt¬≤)
                    </div>

                    <div class="input-group">
                        <label>Your Answer:</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="problem-answer" step="0.1" placeholder="Enter your answer...">
                            <span>seconds</span>
                            <button class="btn btn-primary" onclick="checkProblemAnswer()">Check Answer</button>
                        </div>
                    </div>

                    <div id="problem-feedback"></div>

                    <button class="btn" onclick="newProblem()" style="margin-top: 20px;">New Problem</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Method Trainer -->
    <div id="method-trainer" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">üè†</button>
                <h2>Method Mastery Trainer</h2>
            </div>
            
            <div class="two-column">
                <div class="activity-content">
                    <h3>Training Settings</h3>
                    
                    <div class="input-group">
                        <label>Method:</label>
                        <select id="training-method">
                            <option value="prime">Prime Factorization</option>
                            <option value="estimation">Estimation Method</option>
                            <option value="long">Long Division</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Difficulty:</label>
                        <select id="training-difficulty">
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" onclick="generateTrainingProblem()">Generate Problem</button>
                </div>

                <div class="activity-content">
                    <h3>Current Problem: ‚àö<span id="training-number">144</span></h3>
                    
                    <div class="input-group">
                        <label>Step 1:</label>
                        <input type="text" id="step-1" placeholder="Show your first step...">
                    </div>

                    <div class="input-group">
                        <label>Step 2:</label>
                        <input type="text" id="step-2" placeholder="Continue your work...">
                    </div>

                    <div class="input-group">
                        <label>Final Answer:</label>
                        <input type="number" id="training-final" placeholder="Your final answer...">
                    </div>

                    <button class="btn btn-primary" onclick="checkTrainingWork()">Check My Work</button>

                    <div class="feedback info" style="margin-top: 20px;">
                        <strong>Expected approach:</strong><br>
                        <span id="method-hint">Find prime factors, group into pairs, take one from each pair</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Detective -->
    <div id="error-detective" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">üè†</button>
                <h2>Error Detective Agency</h2>
            </div>
            
            <div class="activity-content">
                <h3 style="margin-bottom: 30px;">üîç Can you spot the error?</h3>
                
                <div class="feedback error" style="margin-bottom: 30px;">
                    <h4 style="color: #dc2626; margin-bottom: 15px;">Suspicious Solution:</h4>
                    <div style="background: white; padding: 20px; border-radius: 8px; font-family: monospace; font-size: 1.1rem;" id="error-example">
                        ‚àö(16 + 9) = ‚àö16 + ‚àö9 = 4 + 3 = 7
                    </div>
                </div>

                <div class="input-group">
                    <label>What's wrong with this solution? Explain the error:</label>
                    <textarea id="error-explanation" placeholder="Describe the mathematical error you found..." style="height: 100px; resize: vertical;"></textarea>
                </div>

                <button class="btn btn-primary" onclick="checkErrorAnalysis()">Submit Analysis</button>

                <div id="error-feedback"></div>

                <button class="btn" onclick="newErrorCase()" style="margin-top: 20px;">Investigate New Case</button>
            </div>
        </div>
    </div>

    <!-- Creative Studio -->
    <div id="creative-studio" class="activity-page">
        <div class="container">
            <div class="activity-header">
                <button class="back-btn" onclick="showDashboard()">üè†</button>
                <h2>Creative Applications Studio</h2>
            </div>
            
            <div class="two-column">
                <div class="activity-content">
                    <h3>Project Settings</h3>
                    
                    <div class="input-group">
                        <label>Project Type:</label>
                        <select id="creative-project">
                            <option value="art">Digital Art Pattern</option>
                            <option value="music">Musical Frequency Harmony</option>
                            <option value="nature">Nature Photography Guide</option>
                            <option value="architecture">Architectural Design</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Pattern Type:</label>
                        <select id="creative-pattern">
                            <option value="squares">Perfect Squares</option>
                            <option value="roots">Square Roots</option>
                            <option value="fibonacci">Fibonacci Squares</option>
                            <option value="spiral">Golden Spiral</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Size/Complexity: <span id="creative-size-display">8</span></label>
                        <input type="range" id="creative-size" min="4" max="12" value="8" oninput="updateCreativeSize()">
                    </div>

                    <button class="btn btn-primary" onclick="generateCreativeProject()">Generate Creative Project</button>
                </div>

                <div class="activity-content">
                    <h3>Creative Output</h3>
                    
                    <div id="creative-output">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div id="art-grid" style="display: inline-grid; grid-template-columns: repeat(8, 25px); gap: 2px; padding: 20px; background: #f3f4f6; border-radius: 8px;">
                                <!-- Art grid will be generated here -->
                            </div>
                        </div>
                        
                        <div class="feedback info">
                            <strong>Mathematical Art:</strong> Perfect squares create beautiful patterns when visualized with color and spacing!
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let userProgress = {
            level: 1,
            xp: 0,
            achievements: [],
            stats: {
                perfectSquaresFound: 0,
                squareRootsCalculated: 0,
                estimationsAttempted: 0,
                problemsSolved: 0
            }
        };

        // Game state
        let currentDetectiveNumber = 16;
        let detectiveScore = 0;
        let detectiveStreak = 0;
        let estimationDifficulty = 'easy';
        let estimationScore = 0;
        let speedMode = 'squares';
        let speedGameActive = false;
        let speedTimer = 60;
        let speedScore = 0;
        let speedStreak = 0;
        let currentSpeedProblem = { question: '', answer: 0 };

        // Utility functions
        function addXP(amount) {
            userProgress.xp += amount;
            userProgress.level = Math.floor(userProgress.xp / 100) + 1;
            updateProgressDisplay();
        }

        function addAchievement(achievement) {
            if (!userProgress.achievements.includes(achievement)) {
                userProgress.achievements.push(achievement);
                showAchievement(achievement);
                updateStatsDisplay();
            }
        }

        function showAchievement(achievement) {
            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div style="display: flex; align-items: center;">
                    <div style="font-size: 2rem; margin-right: 15px;">üèÜ</div>
                    <div>
                        <div style="font-weight: bold;">Achievement Unlocked!</div>
                        <div style="font-size: 0.9rem;">${achievement}</div>
                    </div>
                </div>
            `;
            
            if (document.body) {
                document.body.appendChild(popup);
                setTimeout(() => {
                    if (document.body.contains(popup)) {
                        document.body.removeChild(popup);
                    }
                }, 3000);
            }
        }

        function updateProgressDisplay() {
            const levelEl = document.getElementById('user-level');
            const xpEl = document.getElementById('user-xp');
            const progressEl = document.getElementById('progress-fill');
            
            if (levelEl) levelEl.textContent = userProgress.level;
            if (xpEl) xpEl.textContent = userProgress.xp % 100;
            if (progressEl) progressEl.style.width = `${(userProgress.xp % 100)}%`;
        }

        function updateStatsDisplay() {
            const squaresEl = document.getElementById('squares-found');
            const rootsEl = document.getElementById('roots-calculated');
            const estimationsEl = document.getElementById('estimations-attempted');
            const achievementsEl = document.getElementById('achievements-earned');
            
            if (squaresEl) squaresEl.textContent = userProgress.stats.perfectSquaresFound;
            if (rootsEl) rootsEl.textContent = userProgress.stats.squareRootsCalculated;
            if (estimationsEl) estimationsEl.textContent = userProgress.stats.estimationsAttempted;
            if (achievementsEl) achievementsEl.textContent = userProgress.achievements.length;
        }

        // Navigation functions
        function showActivity(activityId) {
            document.querySelectorAll('.activity-page').forEach(page => {
                page.classList.remove('active');
            });
            
            const targetActivity = document.getElementById(activityId);
            if (targetActivity) {
                targetActivity.classList.add('active');

                // Initialize activity-specific content
                if (activityId === 'visual-builder') {
                    setTimeout(updateSquare, 100);
                } else if (activityId === 'square-detective') {
                    setTimeout(generateDetectiveNumber, 100);
                } else if (activityId === 'estimation-master') {
                    setTimeout(newEstimationChallenge, 100);
                }
            }
        }

        function showDashboard() {
            document.querySelectorAll('.activity-page').forEach(page => {
                page.classList.remove('active');
            });
            const dashboard = document.getElementById('dashboard');
            if (dashboard) {
                dashboard.classList.add('active');
            }
        }

        // Visual Square Builder functions
        function updateSquare() {
            const sizeEl = document.getElementById('square-size');
            if (!sizeEl) return;
            
            const size = parseInt(sizeEl.value);
            const display1 = document.getElementById('square-size-display');
            const display2 = document.getElementById('square-size-display-2');
            const infoEl = document.getElementById('square-info');
            
            if (display1) display1.textContent = size;
            if (display2) display2.textContent = size;
            
            const area = size * size;
            if (infoEl) {
                infoEl.innerHTML = `
                    <p><strong>${size}¬≤ = ${size} √ó ${size} = ${area}</strong></p>
                    <p>Area: ${area} square units</p>
                `;
            }

            // Update visual
            const visual = document.getElementById('square-visual');
            if (visual) {
                visual.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
                visual.innerHTML = '';

                for (let i = 1; i <= area; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'square-cell';
                    const root = Math.sqrt(i);
                    if (root === Math.floor(root)) {
                        cell.classList.add('perfect');
                    }
                    visual.appendChild(cell);
                }
            }

            // Update pattern
            const patternCheckbox = document.getElementById('show-pattern');
            if (patternCheckbox && patternCheckbox.checked) {
                updateOddPattern(size);
            }
        }

        function updateOddPattern(size) {
            const oddSumEl = document.getElementById('odd-sum');
            if (!oddSumEl) return;
            
            const oddNumbers = [];
            for (let i = 1; i <= size; i++) {
                oddNumbers.push(2 * i - 1);
            }
            const sum = oddNumbers.reduce((a, b) => a + b, 0);
            oddSumEl.textContent = `${oddNumbers.join(' + ')} = ${sum}`;
        }

        function animateSquare() {
            const cells = document.querySelectorAll('#square-visual .square-cell');
            cells.forEach((cell, index) => {
                setTimeout(() => {
                    cell.classList.add('animate');
                    setTimeout(() => cell.classList.remove('animate'), 500);
                }, index * 50);
            });
            addXP(10);
        }

        function togglePattern() {
            const patternInfo = document.getElementById('pattern-info');
            const checkbox = document.getElementById('show-pattern');
            
            if (!patternInfo || !checkbox) return;
            
            if (checkbox.checked) {
                patternInfo.style.display = 'block';
                const sizeEl = document.getElementById('square-size');
                if (sizeEl) {
                    updateOddPattern(parseInt(sizeEl.value));
                }
            } else {
                patternInfo.style.display = 'none';
            }
        }

        // Square Detective functions
        function generateDetectiveNumber() {
            const numbers = [4, 9, 15, 16, 20, 25, 30, 36, 49, 50, 64, 75, 81, 100, 121, 144, 169, 196, 225];
            currentDetectiveNumber = numbers[Math.floor(Math.random() * numbers.length)];
            
            const numberEl = document.getElementById('detective-number');
            const feedbackEl = document.getElementById('detective-feedback');
            const proofEl = document.getElementById('detective-proof');
            
            if (numberEl) numberEl.textContent = currentDetectiveNumber;
            if (feedbackEl) feedbackEl.innerHTML = '';
            if (proofEl) proofEl.style.display = 'none';
        }

        function checkPerfectSquare(userAnswer) {
            const actualRoot = Math.sqrt(currentDetectiveNumber);
            const isActuallyPerfect = actualRoot === Math.floor(actualRoot);
            
            const feedbackEl = document.getElementById('detective-feedback');
            const proofEl = document.getElementById('detective-proof');
            
            if (userAnswer === isActuallyPerfect) {
                detectiveScore += 10;
                detectiveStreak++;
                if (feedbackEl) feedbackEl.innerHTML = '<div class="feedback success">Correct! üéâ</div>';
                addXP(15);
                userProgress.stats.perfectSquaresFound++;
                
                // Check achievements
                if (detectiveStreak === 5) {
                    addAchievement('Detective Streak - 5 in a row!');
                }
                if (userProgress.stats.perfectSquaresFound === 25) {
                    addAchievement('Square Master - Found 25 perfect squares!');
                }
            } else {
                detectiveStreak = 0;
                if (feedbackEl) feedbackEl.innerHTML = '<div class="feedback error">Not quite right. Try again!</div>';
            }
            
            // Show proof
            if (proofEl) {
                proofEl.innerHTML = `
                    <div class="feedback info">
                        <strong>Proof:</strong><br>
                        ‚àö${currentDetectiveNumber} = ${actualRoot.toFixed(3)}<br>
                        ${isActuallyPerfect ? 
                            `<span style="color: #10b981;">${actualRoot} √ó ${actualRoot} = ${currentDetectiveNumber} ‚úì</span>` :
                            `<span style="color: #ef4444;">Not a whole number, so ${currentDetectiveNumber} is not a perfect square.</span>`
                        }
                    </div>
                `;
                proofEl.style.display = 'block';
            }
            
            // Update display
            const scoreEl = document.getElementById('detective-score');
            const streakEl = document.getElementById('detective-streak');
            const totalEl = document.getElementById('detective-total');
            
            if (scoreEl) scoreEl.textContent = detectiveScore;
            if (streakEl) streakEl.textContent = detectiveStreak;
            if (totalEl) totalEl.textContent = userProgress.stats.perfectSquaresFound;
            
            updateStatsDisplay();
        }

        // Estimation Master functions
        function setDifficulty(level) {
            estimationDifficulty = level;
            document.querySelectorAll('[id^="diff-"]').forEach(btn => {
                btn.className = 'btn';
            });
            const targetBtn = document.getElementById(`diff-${level}`);
            if (targetBtn) targetBtn.className = 'btn btn-primary';
            newEstimationChallenge();
        }

        function newEstimationChallenge() {
            const ranges = {
                easy: [1, 100],
                medium: [100, 500],
                hard: [500, 1000]
            };
            
            const range = ranges[estimationDifficulty];
            const number = Math.floor(Math.random() * (range[1] - range[0])) + range[0];
            
            const numberEl = document.getElementById('estimation-number');
            const inputEl = document.getElementById('estimation-input');
            const feedbackEl = document.getElementById('estimation-feedback');
            const hintEl = document.getElementById('estimation-hint');
            
            if (numberEl) numberEl.textContent = number;
            if (inputEl) inputEl.value = '';
            if (feedbackEl) feedbackEl.innerHTML = '';
            
            // Update hint
            if (hintEl) {
                const lower = Math.floor(Math.sqrt(number));
                const upper = lower + 1;
                hintEl.textContent = `For ${number}: ${lower}¬≤ = ${lower * lower} and ${upper}¬≤ = ${upper * upper}`;
            }
        }

        function checkEstimation() {
            const numberEl = document.getElementById('estimation-number');
            const inputEl = document.getElementById('estimation-input');
            const feedbackEl = document.getElementById('estimation-feedback');
            const scoreEl = document.getElementById('estimation-score');
            
            if (!numberEl || !inputEl || !feedbackEl) return;
            
            const number = parseInt(numberEl.textContent);
            const userEstimate = parseFloat(inputEl.value);
            
            if (isNaN(number) || isNaN(userEstimate)) {
                feedbackEl.innerHTML = '<div class="feedback error">Please enter a valid number</div>';
                return;
            }
            
            const actual = Math.sqrt(number);
            const difference = Math.abs(actual - userEstimate);
            
            const tolerances = { easy: 0.5, medium: 0.3, hard: 0.2 };
            const tolerance = tolerances[estimationDifficulty];
            
            if (difference <= tolerance) {
                estimationScore += 10;
                feedbackEl.innerHTML = `<div class="feedback success">Excellent! ‚àö${number} ‚âà ${actual.toFixed(3)}</div>`;
                addXP(15);
                userProgress.stats.estimationsAttempted++;
                
                // Check achievements
                if (estimationDifficulty === 'hard') {
                    addAchievement('Estimation Expert - Mastered hard mode!');
                }
                if (estimationScore >= 100) {
                    addAchievement('Century Scorer - 100+ estimation points!');
                }
            } else {
                feedbackEl.innerHTML = `<div class="feedback error">Close! ‚àö${number} ‚âà ${actual.toFixed(3)}. You estimated ${userEstimate}</div>`;
                userProgress.stats.estimationsAttempted++;
            }
            
            if (scoreEl) scoreEl.textContent = estimationScore;
            updateStatsDisplay();
        }

        // Speed Arena functions
        function setSpeedMode(mode) {
            speedMode = mode;
            const squareBtn = document.getElementById('mode-squares');
            const rootBtn = document.getElementById('mode-roots');
            
            if (squareBtn) squareBtn.className = mode === 'squares' ? 'btn btn-primary' : 'btn';
            if (rootBtn) rootBtn.className = mode === 'roots' ? 'btn btn-primary' : 'btn';
        }

        function startSpeedGame() {
            speedGameActive = true;
            speedTimer = 60;
            speedScore = 0;
            speedStreak = 0;
            
            const setupEl = document.getElementById('speed-setup');
            const gameEl = document.getElementById('speed-game');
            const resultsEl = document.getElementById('speed-results');
            
            if (setupEl) setupEl.style.display = 'none';
            if (gameEl) gameEl.style.display = 'block';
            if (resultsEl) resultsEl.style.display = 'none';
            
            generateSpeedProblem();
            startSpeedTimer();
        }

        function generateSpeedProblem() {
            if (speedMode === 'squares') {
                const num = Math.floor(Math.random() * 15) + 1;
                currentSpeedProblem = { question: `${num}¬≤`, answer: num * num };
            } else {
                const perfectSquares = [1, 4, 9, 16, 25, 36, 49, 64, 81, 100, 121, 144, 169, 196, 225];
                const square = perfectSquares[Math.floor(Math.random() * perfectSquares.length)];
                currentSpeedProblem = { question: `‚àö${square}`, answer: Math.sqrt(square) };
            }
            
            const problemEl = document.getElementById('speed-problem');
            const inputEl = document.getElementById('speed-input');
            
            if (problemEl) problemEl.textContent = `${currentSpeedProblem.question} = ?`;
            if (inputEl) {
                inputEl.value = '';
                inputEl.focus();
            }
        }

        function checkSpeedAnswer() {
            const inputEl = document.getElementById('speed-input');
            const scoreEl = document.getElementById('speed-score');
            const streakEl = document.getElementById('speed-streak');
            
            if (!inputEl || !speedGameActive) return;
            
            const userAnswer = parseInt(inputEl.value);
            
            if (isNaN(userAnswer)) return;
            
            if (userAnswer === currentSpeedProblem.answer) {
                speedScore += (10 + speedStreak);
                speedStreak++;
                addXP(5);
                
                // Check achievements
                if (speedStreak === 10) {
                    addAchievement('Speed Demon - 10 streak!');
                }
                if (speedScore >= 200) {
                    addAchievement('Lightning Calculator - 200+ speed points!');
                }
            } else {
                speedStreak = 0;
            }
            
            if (scoreEl) scoreEl.textContent = speedScore;
            if (streakEl) streakEl.textContent = speedStreak;
            
            generateSpeedProblem();
        }

        function startSpeedTimer() {
            const timerInterval = setInterval(() => {
                speedTimer--;
                const timerEl = document.getElementById('speed-timer');
                if (timerEl) timerEl.textContent = `${speedTimer}s`;
                
                if (speedTimer <= 0) {
                    clearInterval(timerInterval);
                    endSpeedGame();
                }
            }, 1000);
        }

        function endSpeedGame() {
            speedGameActive = false;
            const gameEl = document.getElementById('speed-game');
            const resultsEl = document.getElementById('speed-results');
            const finalScoreEl = document.getElementById('final-score');
            
            if (gameEl) gameEl.style.display = 'none';
            if (resultsEl) resultsEl.style.display = 'block';
            if (finalScoreEl) finalScoreEl.textContent = speedScore;
            
            setTimeout(() => {
                const setupEl = document.getElementById('speed-setup');
                if (setupEl) setupEl.style.display = 'block';
                if (resultsEl) resultsEl.style.display = 'none';
            }, 5000);
        }

        // Event listeners
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeElement = document.activeElement;
                if (activeElement && activeElement.id === 'speed-input' && speedGameActive) {
                    checkSpeedAnswer();
                } else if (activeElement && activeElement.id === 'estimation-input') {
                    checkEstimation();
                }
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit for all elements to be ready
            setTimeout(() => {
                updateProgressDisplay();
                updateStatsDisplay();
                
                // Initialize default values for activities
                const defaultDifficulty = document.getElementById('diff-easy');
                if (defaultDifficulty) defaultDifficulty.className = 'btn btn-primary';
                
                const defaultMode = document.getElementById('mode-squares');
                if (defaultMode) defaultMode.className = 'btn btn-primary';
                
                // Initialize other activities
                initializeActivities();
            }, 100);
        });

        function initializeActivities() {
            // Calculator Workshop
            const methodPrime = document.getElementById('method-prime');
            if (methodPrime) methodPrime.className = 'btn btn-primary';
            
            // Construction Studio
            const projectGarden = document.getElementById('project-garden');
            if (projectGarden) projectGarden.className = 'btn btn-primary';
            
            // Pattern Explorer
            const patternAlgebraic = document.getElementById('pattern-algebraic');
            if (patternAlgebraic) patternAlgebraic.className = 'btn btn-primary';
            
            // Problem Solver
            const categoryPhysics = document.getElementById('category-physics');
            if (categoryPhysics) categoryPhysics.className = 'btn btn-primary';
            
            // Initialize creative studio
            updateCreativeSize();
            generateCreativeProject();
        }

        // Calculator Workshop functions
        let currentMethod = 'prime';
        
        function setMethod(method) {
            currentMethod = method;
            document.querySelectorAll('[id^="method-"]').forEach(btn => {
                btn.className = 'btn';
            });
            const targetBtn = document.getElementById(`method-${method}`);
            if (targetBtn) targetBtn.className = 'btn btn-primary';
            updateMethodDemo();
        }

        function updateMethodDemo() {
            const numberEl = document.getElementById('target-number');
            const titleEl = document.getElementById('method-title');
            const stepsEl = document.getElementById('method-steps');
            
            if (!numberEl || !titleEl || !stepsEl) return;
            
            const number = parseInt(numberEl.value) || 144;
            
            const methods = {
                prime: {
                    name: 'Prime Factorization',
                    steps: [
                        `Find prime factors of ${number}`,
                        `${number} = 2‚Å¥ √ó 3¬≤ (example)`,
                        'Group into pairs: (2¬≤)¬≤ √ó (3¬π)¬≤',
                        'Take one from each pair: 2¬≤ √ó 3 = 12',
                        `‚àö${number} = ${Math.sqrt(number)}`
                    ]
                },
                long: {
                    name: 'Long Division Method',
                    steps: [
                        `Group digits in pairs: ${number}`,
                        'Find largest square ‚â§ first group',
                        'Subtract and bring down next pair',
                        'Double quotient and find next digit',
                        `‚àö${number} = ${Math.sqrt(number)}`
                    ]
                },
                estimation: {
                    name: 'Estimation Method',
                    steps: [
                        `Find perfect squares around ${number}`,
                        `${Math.floor(Math.sqrt(number))}¬≤ and ${Math.ceil(Math.sqrt(number))}¬≤`,
                        `${Math.floor(Math.sqrt(number)) ** 2} < ${number} < ${Math.ceil(Math.sqrt(number)) ** 2}`,
                        'Estimate position between these values',
                        `‚àö${number} ‚âà ${Math.sqrt(number).toFixed(3)}`
                    ]
                }
            };
            
            const method = methods[currentMethod];
            titleEl.textContent = `${method.name} for ‚àö${number}`;
            stepsEl.innerHTML = method.steps.map(step => `<li>${step}</li>`).join('');
        }

        // Construction Studio functions
        let currentProject = 'garden';
        
        function setProject(project) {
            currentProject = project;
            document.querySelectorAll('[id^="project-"]').forEach(btn => {
                btn.className = 'btn';
            });
            const targetBtn = document.getElementById(`project-${project}`);
            if (targetBtn) targetBtn.className = 'btn btn-primary';
        }

        function calculateDimensions() {
            const areaEl = document.getElementById('construction-area');
            const sideLengthEl = document.getElementById('side-length');
            const sideValueEl = document.getElementById('side-value');
            const areaDisplayEl = document.getElementById('area-display');
            
            if (!areaEl) return;
            
            const area = parseFloat(areaEl.value) || 100;
            const side = Math.sqrt(area);
            
            if (sideLengthEl) sideLengthEl.textContent = `${side.toFixed(2)} √ó ${side.toFixed(2)}`;
            if (sideValueEl) sideValueEl.textContent = side.toFixed(2);
            if (areaDisplayEl) areaDisplayEl.textContent = area;
            
            addXP(10);
        }

        // Pattern Explorer functions
        let currentPattern = 'algebraic';
        
        function setPattern(pattern) {
            currentPattern = pattern;
            document.querySelectorAll('[id^="pattern-"]').forEach(btn => {
                btn.className = 'btn';
            });
            const targetBtn = document.getElementById(`pattern-${pattern}`);
            if (targetBtn) targetBtn.className = 'btn btn-primary';
            
            // Show/hide pattern sections
            document.getElementById('algebraic-pattern').style.display = pattern === 'algebraic' ? 'block' : 'none';
            document.getElementById('endings-pattern').style.display = pattern === 'endings' ? 'block' : 'none';
            document.getElementById('geometric-pattern').style.display = pattern === 'geometric' ? 'block' : 'none';
            
            if (pattern === 'algebraic') {
                updateAlgebraicPattern();
            }
        }

        function updateAlgebraicPattern() {
            const aEl = document.getElementById('pattern-a');
            const bEl = document.getElementById('pattern-b');
            const calcEl = document.getElementById('pattern-calculation');
            const visualEl = document.getElementById('algebraic-visual');
            
            if (!aEl || !bEl || !calcEl) return;
            
            const a = parseInt(aEl.value) || 3;
            const b = parseInt(bEl.value) || 2;
            
            const leftSide = (a + b) ** 2;
            const rightSide = a**2 + 2*a*b + b**2;
            
            calcEl.innerHTML = `
                <div>Left side: (${a}+${b})¬≤ = <strong>${leftSide}</strong></div>
                <div>Right side: ${a}¬≤ + 2(${a})(${b}) + ${b}¬≤ = ${a**2} + ${2*a*b} + ${b**2} = <strong>${rightSide}</strong></div>
            `;
            
            // Generate visual grid
            if (visualEl) {
                visualEl.style.gridTemplateColumns = `repeat(${a+b}, 20px)`;
                visualEl.innerHTML = '';
                
                for (let i = 0; i < (a+b)**2; i++) {
                    const row = Math.floor(i / (a+b));
                    const col = i % (a+b);
                    const cell = document.createElement('div');
                    cell.style.width = '20px';
                    cell.style.height = '20px';
                    cell.style.border = '1px solid #6366f1';
                    
                    if (row < a && col < a) cell.style.background = '#3b82f6'; // a¬≤
                    else if (row < a || col < a) cell.style.background = '#eab308'; // ab terms
                    else cell.style.background = '#ef4444'; // b¬≤
                    
                    visualEl.appendChild(cell);
                }
            }
        }

        // Battle Game functions
        function startBattleGame() {
            const arenaEl = document.getElementById('battle-arena');
            if (arenaEl) {
                arenaEl.style.display = 'block';
                addXP(15);
            }
        }

        // Problem Solver functions
        let currentCategory = 'physics';
        
        function setCategory(category) {
            currentCategory = category;
            document.querySelectorAll('[id^="category-"]').forEach(btn => {
                btn.className = 'btn';
            });
            const targetBtn = document.getElementById(`category-${category}`);
            if (targetBtn) targetBtn.className = 'btn btn-primary';
        }

        function checkProblemAnswer() {
            const answerEl = document.getElementById('problem-answer');
            const feedbackEl = document.getElementById('problem-feedback');
            
            if (!answerEl || !feedbackEl) return;
            
            const userAnswer = parseFloat(answerEl.value);
            const correctAnswer = 5.4; // Example answer for the physics problem
            
            if (Math.abs(userAnswer - correctAnswer) <= 0.5) {
                feedbackEl.innerHTML = '<div class="feedback success">Excellent! Your answer is correct! üéâ</div>';
                addXP(25);
                userProgress.stats.problemsSolved++;
                updateStatsDisplay();
            } else {
                feedbackEl.innerHTML = `<div class="feedback error">Close! The correct answer is approximately ${correctAnswer} seconds.</div>`;
            }
        }

        function newProblem() {
            const answerEl = document.getElementById('problem-answer');
            const feedbackEl = document.getElementById('problem-feedback');
            
            if (answerEl) answerEl.value = '';
            if (feedbackEl) feedbackEl.innerHTML = '';
            
            addXP(5);
        }

        // Method Trainer functions
        function generateTrainingProblem() {
            const numberEl = document.getElementById('training-number');
            const numbers = [16, 25, 36, 49, 64, 81, 100, 121, 144, 169, 196, 225];
            const randomNumber = numbers[Math.floor(Math.random() * numbers.length)];
            
            if (numberEl) numberEl.textContent = randomNumber;
            
            // Clear previous work
            const step1 = document.getElementById('step-1');
            const step2 = document.getElementById('step-2');
            const final = document.getElementById('training-final');
            
            if (step1) step1.value = '';
            if (step2) step2.value = '';
            if (final) final.value = '';
        }

        function checkTrainingWork() {
            const finalEl = document.getElementById('training-final');
            const numberEl = document.getElementById('training-number');
            
            if (!finalEl || !numberEl) return;
            
            const userAnswer = parseInt(finalEl.value);
            const number = parseInt(numberEl.textContent);
            const correctAnswer = Math.sqrt(number);
            
            if (userAnswer === correctAnswer) {
                addXP(20);
                if (userAnswer) {
                    addAchievement('Method Master - Perfect calculation!');
                }
            }
        }

        // Error Detective functions
        const errorCases = [
            {
                problem: "‚àö(16 + 9) = ‚àö16 + ‚àö9 = 4 + 3 = 7",
                error: "Assuming ‚àö(a + b) = ‚àöa + ‚àöb"
            },
            {
                problem: "‚àö144 = ¬±12",
                error: "Including negative root for principal square root"
            },
            {
                problem: "‚àö50 = ‚àö25 √ó ‚àö2 = 5‚àö2 ‚âà 5 √ó 2 = 10",
                error: "Calculating ‚àö2 as 2"
            }
        ];

        let currentErrorCase = 0;

        function checkErrorAnalysis() {
            const explanationEl = document.getElementById('error-explanation');
            const feedbackEl = document.getElementById('error-feedback');
            
            if (!explanationEl || !feedbackEl) return;
            
            const explanation = explanationEl.value;
            
            if (explanation.length > 10) {
                feedbackEl.innerHTML = `
                    <div class="feedback success" style="margin-top: 20px;">
                        <h4>Great analysis!</h4>
                        <p><strong>The Error:</strong> ${errorCases[currentErrorCase].error}</p>
                        <p><strong>Your Analysis:</strong> ${explanation}</p>
                    </div>
                `;
                addXP(20);
            } else {
                feedbackEl.innerHTML = '<div class="feedback error" style="margin-top: 20px;">Please provide a more detailed explanation.</div>';
            }
        }

        function newErrorCase() {
            currentErrorCase = (currentErrorCase + 1) % errorCases.length;
            const exampleEl = document.getElementById('error-example');
            const explanationEl = document.getElementById('error-explanation');
            const feedbackEl = document.getElementById('error-feedback');
            
            if (exampleEl) exampleEl.textContent = errorCases[currentErrorCase].problem;
            if (explanationEl) explanationEl.value = '';
            if (feedbackEl) feedbackEl.innerHTML = '';
        }

        // Creative Studio functions
        function updateCreativeSize() {
            const sizeEl = document.getElementById('creative-size');
            const displayEl = document.getElementById('creative-size-display');
            
            if (sizeEl && displayEl) {
                displayEl.textContent = sizeEl.value;
            }
        }

        function generateCreativeProject() {
            const sizeEl = document.getElementById('creative-size');
            const gridEl = document.getElementById('art-grid');
            
            if (!sizeEl || !gridEl) return;
            
            const size = parseInt(sizeEl.value) || 8;
            gridEl.style.gridTemplateColumns = `repeat(${size}, 25px)`;
            gridEl.innerHTML = '';
            
            for (let i = 1; i <= size * size; i++) {
                const cell = document.createElement('div');
                cell.style.width = '25px';
                cell.style.height = '25px';
                cell.style.border = '1px solid #d1d5db';
                
                const isPerfect = Math.sqrt(i) % 1 === 0;
                const hue = (i * 137.5) % 360;
                
                cell.style.background = isPerfect 
                    ? `hsl(${hue}, 70%, 50%)` 
                    : `hsl(${hue}, 30%, 90%)`;
                
                gridEl.appendChild(cell);
            }
            
            addXP(15);
        }
    </script>
</body>
</html>
